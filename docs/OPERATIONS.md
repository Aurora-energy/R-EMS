---
ems_section: "15-testing-runbook"
ems_subsection: "operations"
ems_type: "doc"
ems_scope: "operations"
ems_description: "Operations runbook covering quickstart setup, runtime management, and maintenance." 
ems_version: "v0.1.0"
ems_owner: "platform"
---

# Operations Runbook

This runbook walks new operators through installing R-EMS, bringing up the
runtime, and keeping the deployment healthy. Follow the quickstart to run a
local simulation, then reference the operational procedures and maintenance
checklists for day-to-day management.

## Quickstart Installation

1. **Clone the repository**
   ```bash
   git clone https://github.com/ocean-batteries/r-ems.git
   cd r-ems
   ```
2. **Install prerequisites**
   - Linux or macOS host with Docker Engine 24+.
   - Rust toolchain (`rustup` recommended) when performing source builds.
   - GNU Make, Bash, and Git.
3. **Provision the stack**
   - For containerised deployments run the helper script:
     ```bash
     ./scripts/install.sh --skip-run
     ```
     The script installs Docker (unless skipped), configures stack directories
     under `/opt/r-ems`, `/var/lib/r-ems`, and `/etc/r-ems`, and prepares a
     systemd unit (`r-emsd.service`) for later activation.
   - For a local developer build compile the workspace with Cargo:
     ```bash
     cargo build
     ```
4. **Seed configuration**
   - Run the interactive setup wizard to generate a manifest. The CLI stores it
     under the configured config root (default `/etc/r-ems`).
     ```bash
     ./bin/r-emsctl setup wizard
     ```
5. **Start the daemon**
   ```bash
   ./bin/r-emsd
   ```
6. **Verify status**
   ```bash
   ./bin/r-emsctl status
   ```

At this point the controller should be running with default telemetry streams
and you can begin exploring simulation scenarios.

## Running a Simulation Session

1. **Choose a scenario** – Sample datasets live under `configs/scenarios/` in CSV
   or JSON form.
2. **Launch the simulator** – Ensure `r-emsd` is active, then enable simulation
   via the CLI:
   ```bash
   ./bin/r-emsctl simulation start --scenario configs/scenarios/dev_sine.json
   ```
   (Replace the path with your chosen dataset. Hybrid or synthetic modes are
   configured in the manifest generated by the wizard.)
3. **Monitor telemetry** – Use the GUI (`ui/` bundle served by `r-ems-ui`) or
   watch the structured JSON logs emitted to stdout and the rotating log files
   under the configured logging directory.
4. **Stop the simulation** – When finished, shut down the session while keeping
   the daemon online:
   ```bash
   ./bin/r-emsctl simulation stop
   ```

## Operational Procedures

### Configuration Management

- Configuration manifests reside under `/etc/r-ems` by default. Override with the
  `R_EMS_CONFIG_ROOT` environment variable when running alternative environments.
- Re-run the setup wizard to update topology information or to switch between
  production and simulation modes. The CLI validates the manifest before writing
  to disk to avoid partial updates.

### Service Control

- **systemd deployments**
  ```bash
  sudo systemctl enable --now r-emsd.service
  sudo systemctl status r-emsd.service
  ```
- **Docker compose mode** – When `--no-systemd` is passed to the installer, the
  script emits a compose bundle under `/opt/r-ems`. Start it manually:
  ```bash
  cd /opt/r-ems
  docker compose up -d
  docker compose logs -f
  ```

### Observability Checklist

- Logs are written in JSON to stdout and rotated daily under the configured
  logging directory (defaults to `target/dev-logs` in development, `/var/log/r-ems`
  in production).
- Metrics are exposed via the Prometheus `/metrics` endpoint when enabled in the
  configuration (`[metrics].enabled = true`). Scrape the endpoint to feed into
  dashboards and alerts.

### Backup & Recovery

- Archive `/etc/r-ems` (configuration), `/var/lib/r-ems` (state snapshots), and
  `/var/log/r-ems` (logs) on a regular basis.
- To restore a node, provision a new host using the installer, then copy the
  archived directories back before starting the daemon. Validate the configuration
  with `./bin/r-emsctl status` and confirm the simulator or controllers report
  healthy.

### Upgrade Workflow

1. Read the release notes for breaking changes.
2. Pull the updated repository or fetch the new container image.
3. Re-run `./scripts/install.sh --skip-docker` to refresh compose assets without
   reinstalling Docker.
4. Restart the daemon (`systemctl restart r-emsd` or `docker compose up -d`).
5. Confirm the new version via `./bin/r-emsctl status` and by inspecting the log
   banner emitted at startup.

## Appendix

- **Installer flags** – Run `./scripts/install.sh --help` for a full list of
  options, including platform overrides, custom state directories, and Rust
  toolchain controls.
- **Developer workflow** – Use `cargo test` to run the workspace unit tests and
  `cargo fmt`/`cargo clippy` for style and lint checks before submitting changes.

